<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía - Catálogo interactivo - MAC Style Makeup Store</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- Header se cargará dinámicamente -->
    <div id="header-container"></div>

    <main id="main-content">
        <style>
            /* Asegurar que el viewer quede por debajo de la cabecera fija */
            .viewer { position: relative; z-index: 10; }
            .viewer-controls { z-index: 11; }

            /* Ajustes para centrar el contenido del catálogo */
            .catalog-wrap { padding:28px 0; }
            .container.catalog-wrap { max-width:1100px; margin:0 auto; }
            .container.catalog-wrap .row { justify-content:center; align-items:flex-start; }
            .container.catalog-wrap main { flex: 0 0 68%; max-width:68%; }
            .container.catalog-wrap aside { flex: 0 0 30%; max-width:30%; }

            .viewer {
                margin: 0 auto;
                background: #fff;
                border-radius: 12px;
                padding: 16px 32px;
                box-shadow: 0 12px 34px rgba(10,10,10,0.06);
                overflow: visible;
                position: relative;
            }

            .viewer-controls {
                display: flex;
                justify-content: center;
                gap: 16px;
                margin-top: 8px;
                transform: translateY(-10px);
                z-index: 80;
                align-items: center;
            }

            .viewer-controls .nav-btn {
                background: #7b1fa2;
                color: #fff;
                border-radius: 12px;
                width: 60px;
                height: 60px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 12px 28px rgba(123,31,162,0.16);
                border: none;
                font-size: 1.25rem;
                transition: transform .12s ease, box-shadow .12s ease;
                cursor: pointer;
            }
            .viewer-controls .nav-btn:hover { transform: scale(1.06); box-shadow: 0 18px 40px rgba(123,31,162,0.22); }

            @media (max-width:991px){
                .viewer { padding: 14px 18px; }
                .viewer-controls { margin-top: 6px; transform: translateY(-6px); gap: 12px; }
                .viewer-controls .nav-btn { width: 52px; height: 52px; font-size: 1.05rem; }
            }

            .viewer-inner { display:flex; transition:transform .35s ease; width:100%; }
            .step-card { min-width:100%; box-sizing:border-box; padding-right:20px; display:flex; flex-direction:column; align-items:center; }
            .step-media { border-radius:10px; overflow:hidden; background:#f8f8fb; height:320px; display:flex; align-items:center; justify-content:center; width:100%; }
            .step-media img { max-width:90%; max-height:100%; object-fit:contain; display:block; }
            .step-meta { padding-top:14px; max-width:820px; margin:0 auto; text-align:left; }
            .steps-list { display:flex; flex-direction:column; gap:12px; align-items:stretch; }

            .thumb {
                display:flex;
                gap:10px;
                align-items:center;
                padding:10px;
                border-radius:10px;
                background:#fff;
                border:1px solid rgba(0,0,0,0.04);
                cursor: pointer;
                opacity: 0.95;
                transition: transform .15s, box-shadow .15s, opacity .12s;
            }
            .thumb:hover{ transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
            .thumb.active { border-color:#ff5a7a; box-shadow:0 18px 40px rgba(20,20,20,0.06); opacity:1; }

            .viewer-controls .nav-btn[disabled] { cursor: not-allowed; transform: none; box-shadow: 0 8px 18px rgba(0,0,0,0.06); opacity: 0.6; }
            .step-title { font-weight:700; color:#222; font-size:0.98rem; }
            .step-desc { font-size:0.88rem; color:rgba(0,0,0,0.6); }
            .small-note { color:rgba(0,0,0,0.55); font-size:0.92rem; }

            .thumb-img {
                width: 60px;
                height: 45px;
                object-fit: cover;
                border-radius: 6px;
                background: #f5f5f5;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.8rem;
                color: #666;
            }

            .placeholder-box {
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100%;
                text-align: center;
                padding: 20px;
            }

            .preview-img {
                border-radius: 6px;
                border: 1px solid #eee;
            }

            @media (max-width:991px){
                .container.catalog-wrap main, .container.catalog-wrap aside { flex: 0 0 100%; max-width:100%; }
                .viewer-inner { min-height:520px; }
                .thumb-img { width:56px; height:44px; }
                .step-meta { text-align:left; padding:12px 4px; }
            }
        </style>

        <div class="container catalog-wrap">
            <div class="row gx-4">
                <main class="col-lg-8 mb-4">
                    <div class="viewer">
                        <div class="viewer-inner" id="viewerInner">
                            <!-- Los pasos se cargarán dinámicamente con JavaScript -->
                            <div class="step-card" data-step="1">
                                <div class="step-media">
                                    <img src="images/inicio.png" alt="Paso 1" onerror="this.src='https://via.placeholder.com/600x320/e0e0e0/666666?text=Introducción'">
                                </div>
                                <div class="step-meta">
                                    <h4 class="mb-1">Paso 1 — Introducción</h4>
                                    <p class="small text-muted">Venta de productos de maquillaje. Propósito y ventajas para el cliente.</p>
                                    <div class="mt-3 d-flex gap-2">
                                        <a class="btn btn-outline-primary btn-sm" href="products.html">Ir al catálogo</a>
                                        <button class="btn btn-primary btn-sm">Probar</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="viewer-controls">
                            <div class="nav-left">
                                <button id="prevBtn" class="nav-btn" title="Anterior">&larr;</button>
                            </div>
                            <div class="nav-right">
                                <button id="nextBtn" class="nav-btn" title="Siguiente">&rarr;</button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <small class="text-muted">Navega con flechas o haz clic en la lista de la derecha.</small>
                    </div>
                </main>

                <aside class="col-lg-4">
                    <div class="steps-list" id="stepsList">
                        <!-- La lista de pasos se cargará dinámicamente con JavaScript -->
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <p>© 2023 MAC Style Makeup Store. Proyecto estudiantil sin derechos de autor.</p>
    </footer>

    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar el header desde base.html
            fetch('base.html')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const header = doc.querySelector('header');
                    if (header) {
                        document.getElementById('header-container').innerHTML = header.outerHTML;
                    }
                    // Ejecutar scripts del header
                    const scripts = doc.querySelectorAll('script');
                    scripts.forEach(script => {
                        if (script.src) {
                            const newScript = document.createElement('script');
                            newScript.src = script.src;
                            document.head.appendChild(newScript);
                        } else {
                            eval(script.textContent);
                        }
                    });
                })
                .catch(error => console.error('Error loading header:', error));

            // Datos de los pasos
            const steps = [
                {'title':'Introducción','desc':'Venta de productos de maquillaje. Propósito y ventajas para el cliente.', 'image': 'images/inicio.png'},
                {'title':'Navegación general','desc':'Cómo moverse por las secciones: Labios, Ojos, Rostro y promociones.', 'image': 'images/navegador.png'},
                {'title':'Barra de búsqueda','desc':'Escribe nombre o categoría para filtrar resultados.', 'image': 'images/barra_busqueda.png'},
                {'title':'Exploración de productos','desc':'Navega por secciones, filtros y ordena por precio o novedades.', 'image': 'images/filtros.png'},
                {'title':'Ver detalles del producto','desc':'Ficha con descripción, imágenes, precio y reseñas.', 'image': 'images/detalles.png'},
                {'title':'Agregar al carrito','desc':'Selecciona cantidad y pulsa "Agregar" para añadir al carrito.', 'image': 'images/añadir_carrito.png'},
                {'title':'Carrito de compras','desc':'Revisa items, cambia cantidades o elimina antes de pagar.', 'image': 'images/carrito.png'},
                {'title':'Proceso de pago (PayPal)','desc':'Instrucciones para pagar con PayPal: al seleccionar PayPal serás redirigido para completar el pago.', 'image': 'images/paypal.png'},
                {'title':'Soporte y Cerrar sesión','desc':'Contacto de soporte, consejos y dónde está el botón de cerrar sesión.', 'image': 'images/cerrar_sesion.png'}
            ];

            // Cargar viewer
            const viewerInner = document.getElementById('viewerInner');
            viewerInner.innerHTML = '';

            steps.forEach((step, index) => {
                const stepNumber = index + 1;
                const stepCard = document.createElement('div');
                stepCard.className = 'step-card';
                stepCard.setAttribute('data-step', stepNumber);

                let additionalContent = '';
                
                if (stepNumber === 6) {
                    additionalContent = `
                        <div class="mt-3">
                            <div class="small-note">Ejemplo del botón "Agregar":</div>
                            <img src="images/añadir_carrito.png" alt="Botón agregar" class="preview-img mt-2" style="max-height:72px;" onerror="this.src='https://via.placeholder.com/200x50/e0e0e0/666666?text=Botón+Agregar'">
                        </div>
                    `;
                } else if (stepNumber === 8) {
                    additionalContent = `
                        <div class="mt-3">
                            <h6 class="mb-1">Pago con PayPal</h6>
                            <p class="small text-muted mb-1">Al elegir PayPal serás redirigido a la pasarela segura de PayPal. Usa tu cuenta PayPal o paga con tarjeta según opciones disponibles.</p>
                            <img src="images/paypal.png" alt="PayPal" class="preview-img mt-2" style="max-height:72px;" onerror="this.src='https://via.placeholder.com/200x50/003087/ffffff?text=PayPal'">
                            <p class="small text-muted mt-2">Si estás en modo sandbox, usa credenciales de prueba; en producción verifica las credenciales de PayPal en config.</p>
                        </div>
                    `;
                } else if (stepNumber === 9) {
                    additionalContent = `
                        <div class="mt-3">
                            <h6 class="mb-1">Cerrar sesión</h6>
                            <p class="small text-muted mb-1">El botón de cerrar sesión se encuentra en la cabecera (normalmente junto al perfil).</p>
                            <img src="images/cerrar_sesion.png" alt="Cerrar sesión" class="preview-img mt-2" style="max-height:72px;" onerror="this.src='https://via.placeholder.com/200x50/e0e0e0/666666?text=Cerrar+Sesión'">
                        </div>
                    `;
                }

                stepCard.innerHTML = `
                    <div class="step-media">
                        <img src="${step.image}" alt="Paso ${stepNumber}" onerror="this.src='https://via.placeholder.com/600x320/e0e0e0/666666?text=Paso+${stepNumber}'">
                    </div>
                    <div class="step-meta">
                        <h4 class="mb-1">Paso ${stepNumber} — ${step.title}</h4>
                        <p class="small text-muted">${step.desc}</p>
                        ${additionalContent}
                        <div class="mt-3 d-flex gap-2">
                            <a class="btn btn-outline-primary btn-sm" href="products.html">Ir al catálogo</a>
                            <button class="btn btn-primary btn-sm" onclick="testStep(${stepNumber})">Probar</button>
                        </div>
                    </div>
                `;

                viewerInner.appendChild(stepCard);
            });

            // Cargar lista de pasos
            const stepsList = document.getElementById('stepsList');
            steps.forEach((step, index) => {
                const stepNumber = index + 1;
                const thumb = document.createElement('div');
                thumb.className = `thumb ${stepNumber === 1 ? 'active' : ''}`;
                thumb.setAttribute('data-step', stepNumber);
                
                thumb.innerHTML = `
                    <img class="thumb-img" src="${step.image}" alt="Thumb ${stepNumber}" onerror="this.innerHTML='<div class=\"thumb-img\">${stepNumber}</div>'">
                    <div>
                        <div class="step-title">Paso ${stepNumber} — ${step.title}</div>
                        <div class="step-desc">${step.desc}</div>
                    </div>
                `;

                thumb.addEventListener('click', () => updateViewer(stepNumber));
                stepsList.appendChild(thumb);
            });

            // Funcionalidad del viewer
            const total = steps.length;
            let current = 1;
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            function updateViewer(index){
                index = Math.max(1, Math.min(total, index));
                current = index;
                const x = - (index - 1) * 100;
                viewerInner.style.transform = 'translateX(' + x + '%)';

                document.querySelectorAll('#stepsList .thumb').forEach(t => t.classList.remove('active'));
                const activeThumb = document.querySelector('#stepsList .thumb[data-step="' + index + '"]');
                if(activeThumb) activeThumb.classList.add('active');

                prevBtn.disabled = (current === 1);
                nextBtn.disabled = (current === total);
            }

            prevBtn.addEventListener('click', () => updateViewer(current - 1));
            nextBtn.addEventListener('click', () => updateViewer(current + 1));

            // Inicializar
            updateViewer(1);

            // Función global para probar pasos
            window.testStep = function(stepNumber) {
                switch(stepNumber) {
                    case 1:
                        window.location.href = 'index.html';
                        break;
                    case 2:
                    case 3:
                    case 4:
                    case 5:
                        window.location.href = 'products.html';
                        break;
                    case 6:
                        // Ya está en products.html
                        window.location.href = 'products.html';
                        break;
                    case 7:
                        window.location.href = 'cart.html';
                        break;
                    case 8:
                        window.location.href = 'checkout.html';
                        break;
                    case 9:
                        // Mostrar mensaje sobre cerrar sesión
                        alert('El botón de cerrar sesión se encuentra en el menú desplegable de la esquina superior derecha (ícono de tres rayas)');
                        break;
                }
            };
        });
    </script>
</body>
</html>
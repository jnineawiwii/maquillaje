<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAC Style Makeup Store</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script src="js/firebase-config.js"></script>

    <style>
        :root{
            --base-font-size: 16px;
            --base-line-height: 1.5;
            --base-spacing: 1rem;
            --site-header-height: 70px;
        }
        
        html {
            font-size: var(--base-font-size);
            line-height: var(--base-spacing);
        }

        body {
            padding-top: var(--site-header-height);
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--site-header-height);
            z-index: 1050;
            background: linear-gradient(90deg,#040210 0%, #0b0212 100%);
            color: #fff;
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 8px 20px;
        }

        .nav-brand { 
            margin-right: 12px; 
            font-weight:700; 
            color:#fff; 
            text-decoration:none; 
            font-size:1.25rem; 
        }
        
        .search-container { 
            flex: 1 1 480px; 
            margin: 0 20px; 
        }
        
        .search-form {
            display: flex;
            width: 100%;
        }
        
        .search-form input {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 4px 0 0 4px;
        }
        
        .search-form button {
            background: #7b1fa2;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .nav-menu { 
            display:flex; 
            gap:18px; 
            align-items:center; 
            margin-left:auto; 
            list-style:none; 
            padding:0; 
            margin:0; 
        }
        
        .nav-menu li { 
            display:inline-flex; 
            align-items:center; 
        }
        
        .nav-menu a, .nav-menu span { 
            color:#fff; 
            text-decoration:none; 
            padding:6px 8px; 
        }

        .dropdown { position: relative; }
        
        .dropdown-btn { 
            background: none; 
            border: none; 
            color: white; 
            cursor: pointer; 
            font-size: 1.2rem; 
            padding: 5px;
        }
        
        .dropdown-content { 
            display: none; 
            position: absolute; 
            right: 0; 
            top: 100%; 
            background: #1a1a1a; 
            min-width: 220px; 
            border-radius: 8px; 
            padding: 10px 0; 
            z-index: 1100;
        }
        
        .dropdown.show .dropdown-content { display: block; }
        
        .dropdown-content a, .dropdown-content button { 
            display: block; 
            width: 100%; 
            text-align: left; 
            background: none; 
            border: none; 
            color: white; 
            padding: 8px 16px; 
            text-decoration: none; 
            cursor: pointer; 
        }
        
        .dropdown-content a:hover, .dropdown-content button:hover { background: #333; }

        .cart-icon {
            position: relative;
            text-decoration: none;
            color: white;
        }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e91e63;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
        }
        
        .bump { animation: bump 0.2s ease-in-out; }
        
        @keyframes bump {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .site-footer {
            background: #f5f5f5;
            padding: 20px;
            text-align: center;
            margin-top: 40px;
        }

        /* Estilos para el contenido principal */
        .page-section {
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background: white;
            transition: transform 0.2s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
        }

        .product-card h3 {
            margin: 10px 0 5px;
            color: #333;
        }

        .product-card .price {
            font-weight: bold;
            color: #7b1fa2;
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .product-card button {
            background: #7b1fa2;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .product-card button:hover {
            background: #6a1b9a;
        }

        /* Estilos para el carrito */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .cart-total {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: right;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        /* Estilos para controles de accesibilidad */
        .accessibility-controls {
            padding: 10px;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
            margin: 10px 0;
        }

        .accessibility-controls details {
            margin-bottom: 10px;
        }

        .accessibility-controls summary {
            cursor: pointer;
            font-weight: bold;
        }

        .accessibility-controls .control-group {
            margin-top: 10px;
            padding-left: 10px;
        }

        .accessibility-controls label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .accessibility-controls input[type="range"] {
            width: 100%;
        }

        .accessibility-controls button {
            background: #7b1fa2;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 5px;
        }

        /* Estilos para modo oscuro */
        .dark-mode {
            background-color: #1a1a1a;
            color: #f0f0f0;
        }

        .dark-mode .page-section {
            background: #2d2d2d;
            color: #f0f0f0;
        }

        .dark-mode .product-card {
            background: #3d3d3d;
            border-color: #555;
        }

        .dark-mode .product-card h3 {
            color: #f0f0f0;
        }

        /* Estilos para alto contraste */
        .high-contrast {
            background: #000 !important;
            color: #fff !important;
        }

        .high-contrast .page-section {
            background: #000 !important;
            color: #fff !important;
            border: 2px solid #fff;
        }

        .high-contrast .product-card {
            background: #000 !important;
            color: #fff !important;
            border: 1px solid #fff;
        }

        .high-contrast a {
            color: #ffff00 !important;
        }

        /* Estilos para escala de grises */
        .grayscale {
            filter: grayscale(var(--grayscale-percent, 100%));
        }

        /* Estilos para formularios */
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 400px;
            margin: 0 auto;
        }

        form input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        form button {
            background: #7b1fa2;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn {
            display: inline-block;
            background: #7b1fa2;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
            margin-top: 10px;
        }

        /* Estilos para filtros */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filters button {
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .filters button.active {
            background: #7b1fa2;
            color: white;
        }

        /* Estilos para el lector de pantalla */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .sr-announcement {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #7b1fa2;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            z-index: 9999;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sr-announcement.show {
            opacity: 1;
        }

        /* Estilos para iframe */
        .page-iframe {
            width: 100%;
            /* Altura ajustada para no chocar con el header/footer */
            height: calc(100vh - var(--site-header-height) - 140px); 
            border: none;
            border-radius: 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<header>
<nav class="navbar">
    <div class="nav-brand">
        <a href="#home">MAC Style</a>
    </div>

    <div class="search-container">
        <form class="search-form" onsubmit="buscarProductos(event)">
            <input type="text" id="search-input" placeholder="Buscar productos...">
            <button type="submit"><i class="fas fa-search"></i></button>
        </form>
    </div>

    <ul class="nav-menu">
        <li id="admin-link" style="display: none;">
            <a href="#admin">Administraci√≥n</a>
        </li>
        
        <li><a href="#products">Productos</a></li>
        <li><a href="#products?category=labios">Labios</a></li>
        <li><a href="#products?category=ojos">Ojos</a></li>
        <li><a href="#products?category=rostro">Rostro</a></li>

        <li id="user-info" style="display: none;">
            <span class="user-welcome" id="user-welcome"></span>
        </li>

        <li id="cart-link" style="display: none;">
    <!-- OPCI√ìN RECOMENDADA: -->
<a href="http://localhost:8000/cart.html" class="cart-icon">üõí<span class="cart-count">0</span></a>
</li>
        </li>

        <li class="dropdown">
            <button class="dropdown-btn"><i class="fas fa-bars"></i></button>
            <div class="dropdown-content">
                <a href="#guide">Gu√≠a de usuario</a>
                
                <div class="accessibility-controls">
                    <details>
                      <summary>Tama√±o de lectura</summary>
                      <div class="control-group">
                        <label for="fontSizeRange">
                          <span>Fuente</span>
                          <span id="fontSizeValue">16px</span>
                        </label>
                        <input id="fontSizeRange" type="range" min="12" max="28" step="1" value="16">
                        <button id="fontSizeReset">Restablecer</button>
                      </div>
                    </details>

                    <details>
                      <summary>Espaciado</summary>
                      <div class="control-group">
                        <label for="spacingRange">
                          <span>Interlineado</span>
                          <span id="spacingValue">1rem</span>
                        </label>
                        <input id="spacingRange" type="range" min="0.5" max="2.0" step="0.05" value="1.0">
                        <button id="spacingReset">Restablecer</button>
                      </div>
                    </details>

                    <button id="toggleContrastBtn">Alto contraste</button>

                    <details>
                      <summary>Escala de grises</summary>
                      <div class="control-group">
                        <label for="grayscaleRange">
                          <span>Intensidad</span>
                          <span id="grayscaleValue">0%</span>
                        </label>
                        <input id="grayscaleRange" type="range" min="0" max="100" step="1" value="0">
                        <button id="grayscaleReset">Restablecer</button>
                      </div>
                    </details>
                </div>

                <button id="srToggleBtnMenu">Lector</button>
                <button id="themeToggleBtnMenu">Cambiar a modo oscuro</button>
                
                <div id="auth-links">
                    <a href="#login">Iniciar Sesi√≥n</a>
                    <a href="#register">Registrarse</a>
                </div>
            </div>
        </li>
    </ul>
</nav>
</header>

<main id="main-content">
    <div id="page-content">
        </div>
</main>

<div id="sr-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<div id="sr-visual-announcer" class="sr-announcement" aria-hidden="true"></div>



<script>
// ====================================================================
// Sistema de rutas mejorado (A√ëADIDO 'checkout' y modificado botones)
// ====================================================================
function cargarPagina(pagina, parametros = {}) {
    const contenido = document.getElementById('page-content');
    
    switch(pagina) {
        case 'home':
            contenido.innerHTML = `
                <section class="page-section">
                    <h1>Bienvenido a MAC Style</h1>
                    <p>Tu tienda de maquillaje favorita</p>
                    <a href="#products" class="btn">Ver Productos</a>
                </section>
            `;
            break;
            
        case 'products':
            const categoria = parametros.category || 'all';
            contenido.innerHTML = `
                <section class="page-section">
                    <h1>Productos</h1>
                    <div class="filters">
                        <button onclick="filtrarProductos('all')" class="${categoria === 'all' ? 'active' : ''}">Todos</button>
                        <button onclick="filtrarProductos('labios')" class="${categoria === 'labios' ? 'active' : ''}">Labios</button>
                        <button onclick="filtrarProductos('ojos')" class="${categoria === 'ojos' ? 'active' : ''}">Ojos</button>
                        <button onclick="filtrarProductos('rostro')" class="${categoria === 'rostro' ? 'active' : ''}">Rostro</button>
                    </div>
                    <div id="products-grid" class="product-grid"></div>
                </section>
            `;
            cargarProductos(categoria);
            break;
            
    
            
        case 'checkout': // NUEVO CASE PARA CARGAR EL IFRAME DE CHECKOUT
             contenido.innerHTML = `
                <section class="page-section">
                    <h1>Proceso de Pago</h1>
                    <iframe src="checkout.html" class="page-iframe" title="Proceso de pago Mercado Pago"></iframe>
                </section>
            `;
            break;
            
        case 'guide':
        case 'login':
        case 'register':
            // L√≥gica para cargar otras p√°ginas en iframes
            const titleMap = {
                'guide': 'Gu√≠a de Usuario',
                'login': 'Iniciar Sesi√≥n',
                'register': 'Registrarse'
            };
            const pageTitle = titleMap[pagina] || pagina;

            contenido.innerHTML = `
                <section class="page-section">
                    <h1>${pageTitle}</h1>
                    <iframe src="${pagina}.html" class="page-iframe" title="${pageTitle}"></iframe>
                </section>
            `;
            break;
            
        default:
            cargarPagina('home');
    }
}

// ====================================================================
// Funciones de productos (Sin cambios)
// ====================================================================
async function cargarProductos(categoria = 'all') {
    try {
        console.log('üîÑ Cargando productos...', categoria);
        
        if (typeof db === 'undefined') {
            console.error('‚ùå Firestore no est√° inicializado');
            mostrarProductos([]);
            return;
        }
        
        let query = db.collection('products');
        
        if (categoria !== 'all') {
            query = query.where('category', '==', categoria);
        }
        
        const snapshot = await query.get();
        const productos = [];
        
        snapshot.forEach(doc => {
            const data = doc.data();
            console.log('üì¶ Producto cargado:', data.name, data.image); // üëà Ahora usa data.image
            productos.push({ 
                id: doc.id, 
                name: data.name,
                description: data.description,
                price: data.price,
                category: data.category,
                imageUrl: data.image // üëà CAMBIO IMPORTANTE: data.image en lugar de data.imageUrl
            });
        });
        
        console.log(`‚úÖ ${productos.length} productos cargados`);
        mostrarProductos(productos);
        
    } catch (error) {
        console.error('‚ùå Error cargando productos:', error);
        mostrarProductos([]);
    }
}

function mostrarProductos(productos) {
    const grid = document.getElementById('products-grid');
    
    if (!grid) return;
    
    if (productos.length === 0) {
        grid.innerHTML = '<p>No se encontraron productos</p>';
        return;
    }
    
    grid.innerHTML = productos.map(producto => `
        <div class="product-card">
            <img src="${producto.imageUrl}" 
                 alt="${producto.name}"
                 style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px;"
                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2VuIG5vIGRpc3BvbmlibGU8L3RleHQ+PC9zdmc+'">
            <h3>${producto.name}</h3>
            <p>${producto.description}</p>
            <p class="price">$${producto.price} MXN</p>
            <button onclick="agregarAlCarrito('${producto.id}', '${producto.name.replace(/'/g, "\\'")}', ${producto.price}, '${producto.category}')">
                <i class="fas fa-cart-plus"></i> Agregar al Carrito
            </button>
        </div>
    `).join('');
}
// ====================================================================
// A√ëADE ESTA FUNCI√ìN FALTANTE
// ====================================================================
function filtrarProductos(categoria) {
    console.log('üîç Filtrando por categor√≠a:', categoria);
    window.location.hash = `products${categoria !== 'all' ? `?category=${categoria}` : ''}`;
}
// ====================================================================
// Funciones del Carrito (Modificada la l√≥gica de "Comprar")
// ====================================================================
function agregarAlCarrito(id, nombre, precio, categoria = 'General') {
    let carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    const existe = carrito.find(item => item.id === id);
    
    if (existe) {
        existe.cantidad++;
    } else {
        carrito.push({ 
            id, 
            nombre, 
            precio: parseFloat(precio), 
            cantidad: 1,
            categoria: categoria // üëà A√±adir categor√≠a al carrito
        });
    }
    
    localStorage.setItem('carrito', JSON.stringify(carrito));
    actualizarContadorCarrito();
    
    const cartCount = document.querySelector('.cart-count');
    if (cartCount) {
        cartCount.classList.add('bump');
        setTimeout(() => cartCount.classList.remove('bump'), 200);
    }
    
    srAnnounce(`${nombre} agregado al carrito`);
}

function actualizarContadorCarrito() {
    const carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    const total = carrito.reduce((sum, item) => sum + item.cantidad, 0);
    const cartCountEl = document.querySelector('.cart-count');
    if (cartCountEl) {
        cartCountEl.textContent = total;
    }
}

function mostrarCarrito() {
    const carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    const itemsDiv = document.getElementById('cart-items');
    const totalDiv = document.getElementById('total-price');
    
    if (!itemsDiv || !totalDiv) return; // Asegurar que los elementos existen

    if (carrito.length === 0) {
        itemsDiv.innerHTML = '<p>Tu carrito est√° vac√≠o</p>';
        totalDiv.textContent = '0.00';
        return;
    }
    
    let total = 0;
    itemsDiv.innerHTML = carrito.map(item => {
        const subtotal = item.precio * item.cantidad;
        total += subtotal;
        return `
            <div class="cart-item">
                <div class="cart-item-info">
                    <h3>${item.nombre}</h3>
                    <p>Precio: $${item.precio.toFixed(2)} x ${item.cantidad} = $${subtotal.toFixed(2)}</p>
                </div>
                <div class="cart-item-actions">
                    <button onclick="cambiarCantidad('${item.id}', ${item.cantidad - 1})">-</button>
                    <span>${item.cantidad}</span>
                    <button onclick="cambiarCantidad('${item.id}', ${item.cantidad + 1})">+</button>
                    <button onclick="removerDelCarrito('${item.id}')">Eliminar</button>
                </div>
            </div>
        `;
    }).join('');
    
    totalDiv.textContent = total.toFixed(2);
}

function cambiarCantidad(id, nuevaCantidad) {
    if (nuevaCantidad < 1) {
        removerDelCarrito(id);
        return;
    }
    
    let carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    const item = carrito.find(item => item.id === id);
    
    if (item) {
        item.cantidad = nuevaCantidad;
        localStorage.setItem('carrito', JSON.stringify(carrito));
        mostrarCarrito();
        actualizarContadorCarrito();
    }
}

function removerDelCarrito(id) {
    let carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    const itemNombre = carrito.find(item => item.id === id)?.nombre || 'Producto';
    carrito = carrito.filter(item => item.id !== id);
    localStorage.setItem('carrito', JSON.stringify(carrito));
    mostrarCarrito();
    actualizarContadorCarrito();
    srAnnounce(`${itemNombre} eliminado del carrito`);
}

// **NUEVA FUNCI√ìN DE REDIRECCI√ìN**
function redirigirACheckout() {
    const carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    
    if (carrito.length === 0) {
        srAnnounce('Tu carrito est√° vac√≠o, no puedes pagar');
        alert('Tu carrito est√° vac√≠o');
        return;
    }
    
    // Cambia el hash para que cargarPagina cargue el iframe de checkout.html
    window.location.hash = 'checkout';
    srAnnounce('Redirigiendo al proceso de pago');
}

// Eliminamos la funci√≥n 'finalizarCompra' ya que el proceso pasa a checkout.html
// Puedes borrarla si quieres.

// ====================================================================
// Funciones de accesibilidad (Sin cambios)
// ====================================================================
function srAnnounce(msg, politeness = 'polite', visualFeedback = true) {
    const el = document.getElementById('sr-announcer');
    if (el) {
        el.setAttribute('aria-live', politeness);
        el.textContent = '';
        setTimeout(() => el.textContent = msg, 100);
    }
    
    if (visualFeedback) {
        const visualEl = document.getElementById('sr-visual-announcer');
        if (visualEl) {
            visualEl.textContent = msg;
            visualEl.classList.add('show');
            setTimeout(() => {
                visualEl.classList.remove('show');
            }, 3000);
        }
    }
}

// ====================================================================
// Inicializaci√≥n y eventos (Sin cambios mayores)
// ====================================================================
document.addEventListener('DOMContentLoaded', function() {
    // Navegaci√≥n
    window.addEventListener('hashchange', function() {
        const hash = window.location.hash.substring(1);
        let pagina = 'home';
        let parametros = {};
        
        if (hash.includes('?')) {
            const parts = hash.split('?');
            pagina = parts[0];
            const searchParams = new URLSearchParams(parts[1]);
            parametros = Object.fromEntries(searchParams.entries());
        } else if (hash) {
            pagina = hash;
        }
        
        cargarPagina(pagina, parametros);
    });
    
    // Cargar p√°gina inicial
    const hash = window.location.hash.substring(1);
    if (!hash) {
        cargarPagina('home');
    } else {
        window.dispatchEvent(new Event('hashchange'));
    }
    
    // Actualizar carrito
    actualizarContadorCarrito();
    
    // Auth state (Aseg√∫rate de que 'auth' y 'db' est√°n definidos en firebase-config.js)
    if (typeof auth !== 'undefined') {
        auth.onAuthStateChanged(usuario => {
            const userInfo = document.getElementById('user-info');
            const authLinks = document.getElementById('auth-links');
            const cartLink = document.getElementById('cart-link');
            const adminLink = document.getElementById('admin-link');
            
            if (usuario) {
                userInfo.style.display = 'block';
                cartLink.style.display = 'block';
                document.getElementById('user-welcome').textContent = `Hola, ${usuario.email}`;
                authLinks.innerHTML = '<a href="#" onclick="logout()">Cerrar Sesi√≥n</a>';
                
                if (typeof db !== 'undefined') {
                    db.collection('users').doc(usuario.uid).get().then(doc => {
                        if (doc.exists && doc.data().role === 'admin') {
                            adminLink.style.display = 'block';
                        }
                    });
                }
            } else {
                userInfo.style.display = 'none';
                cartLink.style.display = 'none';
                adminLink.style.display = 'none';
                authLinks.innerHTML = `
                    <a href="#login">Iniciar Sesi√≥n</a>
                    <a href="#register">Registrarse</a>
                `;
            }
        });
    }

    // Dropdown
    document.querySelector('.dropdown-btn').addEventListener('click', function(e) {
        e.stopPropagation();
        document.querySelector('.dropdown').classList.toggle('show');
    });

    document.addEventListener('click', function() {
        document.querySelector('.dropdown').classList.remove('show');
    });
    
    // Controles de accesibilidad
    inicializarControlesAccesibilidad();
});

function inicializarControlesAccesibilidad() {
    // ... (Tu c√≥digo de accesibilidad existente) ...
    // Tama√±o de fuente
    const fontSizeRange = document.getElementById('fontSizeRange');
    const fontSizeValue = document.getElementById('fontSizeValue');
    const fontSizeReset = document.getElementById('fontSizeReset');
    
    if (fontSizeRange) {
        fontSizeRange.addEventListener('input', function() {
            document.documentElement.style.fontSize = this.value + 'px';
            fontSizeValue.textContent = this.value + 'px';
        });
        
        fontSizeReset.addEventListener('click', function() {
            fontSizeRange.value = 16;
            document.documentElement.style.fontSize = '16px';
            fontSizeValue.textContent = '16px';
            srAnnounce('Tama√±o de fuente restablecido');
        });
    }
    
    // Espaciado
    const spacingRange = document.getElementById('spacingRange');
    const spacingValue = document.getElementById('spacingValue');
    const spacingReset = document.getElementById('spacingReset');
    
    if (spacingRange) {
        spacingRange.addEventListener('input', function() {
            document.documentElement.style.setProperty('--base-spacing', this.value + 'rem');
            spacingValue.textContent = this.value + 'rem';
        });
        
        spacingReset.addEventListener('click', function() {
            spacingRange.value = 1.0;
            document.documentElement.style.setProperty('--base-spacing', '1rem');
            spacingValue.textContent = '1rem';
            srAnnounce('Espaciado restablecido');
        });
    }
    
    // Alto contraste
    const toggleContrastBtn = document.getElementById('toggleContrastBtn');
    
    if (toggleContrastBtn) {
        toggleContrastBtn.addEventListener('click', function() {
            document.body.classList.toggle('high-contrast');
            const isActive = document.body.classList.contains('high-contrast');
            this.textContent = isActive ? 'Desactivar alto contraste' : 'Alto contraste';
            srAnnounce(isActive ? 'Alto contraste activado' : 'Alto contraste desactivado');
        });
    }
    
    // Escala de grises
    const grayscaleRange = document.getElementById('grayscaleRange');
    const grayscaleValue = document.getElementById('grayscaleValue');
    const grayscaleReset = document.getElementById('grayscaleReset');
    
    if (grayscaleRange) {
        grayscaleRange.addEventListener('input', function() {
            document.documentElement.style.setProperty('--grayscale-percent', this.value + '%');
            grayscaleValue.textContent = this.value + '%';
            document.body.classList.toggle('grayscale', this.value > 0);
        });
        
        grayscaleReset.addEventListener('click', function() {
            grayscaleRange.value = 0;
            document.documentElement.style.setProperty('--grayscale-percent', '0%');
            grayscaleValue.textContent = '0%';
            document.body.classList.remove('grayscale');
            srAnnounce('Escala de grises restablecida');
        });
    }
    
    // Lector de pantalla
    const srToggleBtnMenu = document.getElementById('srToggleBtnMenu');
    let srEnabled = false;
    
    if (srToggleBtnMenu) {
        srToggleBtnMenu.addEventListener('click', function() {
            srEnabled = !srEnabled;
            this.textContent = srEnabled ? 'Desactivar lector' : 'Lector';
            this.classList.toggle('active', srEnabled);
            
            if (srEnabled) {
                srAnnounce('Lector de pantalla activado', 'assertive');
            } else {
                srAnnounce('Lector de pantalla desactivado', 'assertive');
            }
        });
    }
    
    // Modo oscuro
    const themeToggleBtnMenu = document.getElementById('themeToggleBtnMenu');
    
    if (themeToggleBtnMenu) {
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            themeToggleBtnMenu.textContent = 'Cambiar a modo claro';
        }
        
        themeToggleBtnMenu.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            this.textContent = isDark ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro';
            localStorage.setItem('darkMode', isDark);
            srAnnounce(isDark ? 'Modo oscuro activado' : 'Modo claro activado');
        });
    }
}

function logout() {
    if (typeof auth !== 'undefined') {
        auth.signOut();
    }
    srAnnounce('Sesi√≥n cerrada');
    window.location.hash = 'home';
}

function buscarProductos(event) {
    event.preventDefault();
    const termino = document.getElementById('search-input').value.trim();
    
    if (termino) {
        srAnnounce(`Buscando: ${termino}`);
        alert(`Funcionalidad de b√∫squeda para: ${termino}`);
        // En una implementaci√≥n real, aqu√≠ se cargar√≠a una vista de resultados
        window.location.hash = 'products'; 
    }
}
</script>
</body>
</html>